_id: 4368165038
_parent: https://chester.me/archives/2017/12/voice-control-for-a-non-smart-tv-with-google-home-raspberry-pi-lirc-nginx-lua-ifttt/
replying_to_uid: '4367989897'
message: '<p>Hello Dan! Not sure what could be, but the first thing that comes to mind: --insecure just skips the certificate check. You may still need "-d" followed by the parameters, that is, something like:</p><p><code><br>curl --insecure -d "action=tv_volume_up&amp;secret-key=some_generated_secret" https://my.domain/remote<br></code></p><p>Although TBH failure on that should likely only generate a blank 200 page, not 404. So I''d start debugging by removing some pieces. E.g., replacing the <code>location /remote { ...</code> with a simpler thing like:</p><p><code><br>location /remote {<br>content_by_lua_block {<br>os.execute("/bin/bash -c ''echo hello &gt;&gt; /tmp/lua_out''");<br>}<br>}<br></code></p><p>If a simple request to /remote writes "hello" to the /tmp/lua.out file, it is indeed something with parameter management on the code, or the curl call.</p><p>If it doesn''t, nginx isn''t triggering the lua interpreter.</p><p>In either case, it gives a more specific place to look at. Other things that can give you insight:</p><p>- Does http (instead of https) work? Since you have a listener on port 80, you could try http (and rule out/nail in any certificate/https problem);<br>- Do other HTTP verbs work? (curl default is GET, adding -d changes it to post, but you can specify <code>-x VERB</code>. I''d try each command (including your current setup) with GET, POST and PUT to see if I get any difference on them (if you do, parameter handling is the culprit)<br>- Finally, curl is my go-to tool for these things, but other tools may give you better insight (the browser is usually opaque, but the Network tab inside Firefox/Chrome''s debugger gives all the details). Ah, curl also have --verbose, which will tell you exactly what was sent/received and often reveals details.</p><p>Good luck and let us know how it worked for you!</p>'
name: 'chesterbr'
email: '3a49ee98333d753103cf708e40d36984'
hp: ''
date: 1551970886
            