_id: 4211968083
_parent: https://chester.me/archives/2017/12/voice-control-for-a-non-smart-tv-with-google-home-raspberry-pi-lirc-nginx-lua-ifttt/
replying_to_uid: '4211033153'
message: '<p>Hi! Of course! I did some tests here, and found a couple things:</p><p>First of all, I''m not sure you can simply run `echo` (an internal shell command) or do a console redirect (`&gt;`) directly with `os.execute` - I may be wrong (my Lua-fu is not really good), but I believe it will try (and fail) to start a process with an executable named `echo`.</p><p>To fix that, we need to run a shell (e.g.,) `/bin/bash`, asking it to execute the command (`-c`, for bash). I''d also single-quote the command, include the redirect inside and change it from `&gt;` to `&gt;&gt;`, so you can capture the output of multiple runs)</p><p>The other thing: I''m not entirely sure the nginx process (which runs as the ultra-restricted `www-data` user, to mitigate the damage that any privilege escalation might cause) would be able to write to your `pi` user''s `Desktop`, so instead I''d write to `/tmp`, which often allows anyone to read and write.</p><p>So I''ve put this modified version in my `default` file:</p><p></p><pre><code><br>  location /remote {<br>  lua_need_request_body on;<br>  content_by_lua_block{<br>    local args, err = ngx.req.get_post_args()<br>    if not args then<br>      os.execute("/bin/bash -c ''echo noargs &gt;&gt; /tmp/lua_out''");<br>    end<br>    if args["action"] == "action1" then<br>      os.execute("/bin/bash -c ''echo action1 &gt;&gt; /tmp/lua_out''");<br>    end<br>    }<br>  }<br></code></pre><p></p><p>And once I call it with `action=action1` in the body (becuase we are using `get_post_args`, it won''t work for regular querystring):</p><p></p><pre><code><br>curl -i tv-raspberrypi/remote --data "action=action1"<br></code></pre><p></p><p>we get "action1" added to `/tmp/lua_out`!</p><p>Hope this gets you unstuck - in any case, keep this thread posted!</p>'
name: 'chesterbr'
email: '3a49ee98333d753103cf708e40d36984'
hp: ''
date: 1543195065
            